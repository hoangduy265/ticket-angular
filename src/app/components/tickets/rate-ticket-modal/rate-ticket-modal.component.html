<app-modal [isOpen]="isOpen" title="Đánh giá Ticket" size="sm" (closed)="onClose()" *ngIf="isOpen">
  <!-- Rating Section - Only show if not rated yet -->
  <div *ngIf="!ticket?.rate">
    <!-- Ticket Info -->
    <div class="mb-6">
      <h4 class="text-lg font-semibold text-gray-900 mb-2">{{ ticket?.title }}</h4>
      <p class="text-sm text-gray-600">ID: #{{ ticket?.id }}</p>
    </div>

    <!-- Rating Section -->
    <div class="text-center mb-6">
      <p class="text-sm text-gray-700 mb-4">Vui lòng đánh giá chất lượng xử lý ticket (từ 1 đến 5 sao):</p>

      <!-- Star Rating -->
      <div class="flex justify-center items-center space-x-1 mb-4">
        <button
          *ngFor="let star of stars"
          (click)="selectRating(star)"
          [disabled]="isSubmitting"
          class="focus:outline-none transition-colors"
          [class.cursor-pointer]="!isSubmitting"
          [class.cursor-not-allowed]="isSubmitting">
          <svg
            class="w-8 h-8"
            [class.text-yellow-400]="isStarActive(star)"
            [class.text-gray-300]="!isStarActive(star)"
            fill="currentColor"
            viewBox="0 0 24 24">
            <path d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
          </svg>
        </button>
      </div>

      <!-- Rating Text -->
      <p class="text-sm text-gray-600">
        <span *ngIf="selectedRating === 0">Chọn số sao để đánh giá</span>
        <span *ngIf="selectedRating === 1">Rất tệ (1 sao)</span>
        <span *ngIf="selectedRating === 2">Tệ (2 sao)</span>
        <span *ngIf="selectedRating === 3">Bình thường (3 sao)</span>
        <span *ngIf="selectedRating === 4">Tốt (4 sao)</span>
        <span *ngIf="selectedRating === 5">Xuất sắc (5 sao)</span>
      </p>
    </div>

    <!-- Action Buttons -->
    <div class="flex justify-end gap-3">
      <button
        type="button"
        (click)="onClose()"
        [disabled]="isSubmitting"
        class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500 disabled:opacity-50">
        Hủy
      </button>
      <button
        type="button"
        (click)="onSubmit()"
        [disabled]="selectedRating === 0 || isSubmitting"
        class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50">
        <span *ngIf="isSubmitting" class="inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"></span>
        {{ isSubmitting ? 'Đang đánh giá...' : 'Đánh giá' }}
      </button>
    </div>
  </div>

  <!-- Already Rated Section - Show when ticket is already rated -->
  <div *ngIf="ticket?.rate" class="text-center py-6">
    <div class="mb-4">
      <svg class="w-12 h-12 text-green-500 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
      </svg>
      <h3 class="text-lg font-semibold text-gray-900 mb-2">Đã đánh giá</h3>

      <!-- Display Rated Stars -->
      <div class="flex justify-center items-center space-x-1 mb-2">
        <svg
          *ngFor="let star of stars"
          class="w-6 h-6 text-yellow-400"
          fill="currentColor"
          viewBox="0 0 24 24">
          <path d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
        </svg>
        <span class="ml-2 text-lg font-semibold text-gray-900">{{ ticket?.rate }}/5</span>
      </div>

      <p class="text-sm text-gray-600 mb-2">
        <span *ngIf="ticket?.rate === 1">Rất tệ</span>
        <span *ngIf="ticket?.rate === 2">Tệ</span>
        <span *ngIf="ticket?.rate === 3">Bình thường</span>
        <span *ngIf="ticket?.rate === 4">Tốt</span>
        <span *ngIf="ticket?.rate === 5">Xuất sắc</span>
      </p>

      <p class="text-xs text-gray-500" *ngIf="ticket?.rateAt">
        Đánh giá vào: {{ ticket?.rateAt | date:'dd/MM/yyyy HH:mm' }}
      </p>
    </div>
    <button
      type="button"
      (click)="onClose()"
      class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
      Đóng
    </button>
  </div>
</app-modal>